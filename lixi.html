<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ğŸ§§ LÃ¬ XÃ¬ 2026</title>
<link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:ital,wght@0,400;0,500;0,600;0,700;0,800;1,400&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
<style>
:root {
  --red:      #B8001A;
  --red-dark: #700010;
  --gold:     #FFD700;
  --gold-dim: rgba(255,215,0,0.45);
  --gold-soft:#FFF0A0;
  --bg:       #120003;
  --surface:  rgba(160,0,20,0.18);
  --border:   rgba(255,215,0,0.22);
  --text:     #FFE8A0;
  --muted:    rgba(255,232,160,0.5);
  --green:    #2ECC71;
  --radius:   14px;
}

* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html,body { height:100%; }

body {
  font-family:"Be Vietnam Pro",sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height:100vh;
  max-width:460px;
  margin:0 auto;
  overflow-x:hidden;
  position:relative;
}

body::before {
  content:"";
  position:fixed; inset:0; pointer-events:none;
  background:
    radial-gradient(ellipse 80% 55% at 15% 10%,  rgba(180,0,24,0.4) 0%,transparent 60%),
    radial-gradient(ellipse 60% 60% at 85% 85%,  rgba(100,0,14,0.45) 0%,transparent 60%),
    radial-gradient(ellipse 100% 100% at 50% 50%, rgba(40,0,6,0.6)   0%,transparent 80%);
  z-index:0;
}

.app { position:relative; z-index:1; padding-bottom:90px; }

/* â”€â”€ HEADER â”€â”€ */
.header {
  background: linear-gradient(180deg, rgba(140,0,20,0.95), rgba(90,0,14,0.98));
  border-bottom:2px solid var(--gold);
  padding:14px 20px 10px;
  text-align:center;
  position:sticky; top:0; z-index:99;
  box-shadow:0 4px 24px rgba(0,0,0,0.6);
}
.header-title {
  font-family:"Playfair Display",serif;
  font-size:20px; color:var(--gold);
  text-shadow:0 0 14px rgba(255,215,0,0.55);
  letter-spacing:1px;
}
.header-year { font-size:10px; color:var(--muted); letter-spacing:4px; text-transform:uppercase; margin-top:2px; }

/* â”€â”€ BOTTOM NAV â”€â”€ */
.bnav {
  position:fixed; bottom:0; left:50%; transform:translateX(-50%);
  width:100%; max-width:460px;
  background:rgba(10,0,3,.97);
  border-top:1px solid var(--border);
  display:flex; backdrop-filter:blur(18px);
  z-index:99; overflow-x:auto;
}
.bnav::-webkit-scrollbar { display:none; }
.tab {
  flex:1; min-width:60px; padding:8px 2px 9px;
  text-align:center; cursor:pointer;
  font-size:9px; font-weight:700;
  letter-spacing:.3px; text-transform:uppercase;
  color:var(--muted);
  border-bottom:3px solid transparent;
  transition:all .2s;
  user-select:none; white-space:nowrap;
}
.tab span { font-size:16px; display:block; margin-bottom:2px; }
.tab.on { color:var(--gold); border-bottom-color:var(--gold); }

/* â”€â”€ PAGES â”€â”€ */
.page { display:none; padding:12px; }
.page.on { display:block; }

/* â”€â”€ CARD â”€â”€ */
.card {
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:15px;
  margin-bottom:11px;
  backdrop-filter:blur(8px);
}
.card-hd {
  font-size:10px; font-weight:800; letter-spacing:2.5px;
  text-transform:uppercase; color:var(--gold);
  margin-bottom:12px;
  display:flex; align-items:center; gap:7px;
}

/* â”€â”€ Tá»”NG TIá»€N â”€â”€ */
.total-card {
  background:linear-gradient(145deg, rgba(180,0,24,0.45), rgba(80,0,12,0.7));
  border:2px solid var(--gold);
  border-radius:18px; padding:20px 16px;
  text-align:center; margin-bottom:11px;
  position:relative; overflow:hidden;
}
.total-card::after {
  content:"å›";
  position:absolute; right:10px; top:-4px;
  font-size:72px; opacity:.05; pointer-events:none; line-height:1;
}
.total-lbl { font-size:10px; color:var(--muted); letter-spacing:3px; text-transform:uppercase; }
.total-num {
  font-family:"Playfair Display",serif;
  font-size:38px; color:var(--gold);
  font-weight:800; margin:6px 0 2px;
  text-shadow:0 0 20px rgba(255,215,0,0.35);
  transition:all .4s; word-break:break-all;
}
.total-row { display:flex; justify-content:center; gap:24px; margin-top:10px; }
.tr-item { text-align:center; }
.tr-val { font-size:16px; font-weight:800; color:var(--gold-soft); }
.tr-lbl { font-size:10px; color:var(--muted); margin-top:1px; }

.prog-wrap { margin-top:13px; }
.prog-hd { display:flex; justify-content:space-between; font-size:10px; margin-bottom:5px; color:var(--muted); }
.prog-hd strong { color:var(--gold); }
.prog-track { height:7px; background:rgba(255,255,255,0.08); border-radius:10px; overflow:hidden; }
.prog-fill {
  height:100%; border-radius:10px;
  background:linear-gradient(90deg,#b8860b,var(--gold));
  transition:width .7s cubic-bezier(.4,0,.2,1); position:relative;
}
.prog-fill::after {
  content:""; position:absolute;
  right:0;top:0;bottom:0;width:18px;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,.35));
}

/* â”€â”€ INPUT â”€â”€ */
.field { margin-bottom:10px; }
.field label { display:block; font-size:10px; color:var(--muted); letter-spacing:1.5px; text-transform:uppercase; margin-bottom:5px; }
.input {
  width:100%; padding:11px 13px;
  background:rgba(0,0,0,0.45);
  border:1px solid var(--border);
  border-radius:10px; color:var(--text);
  font-family:"Be Vietnam Pro",sans-serif;
  font-size:15px; font-weight:600;
  outline:none; transition:border-color .2s;
}
.input:focus { border-color:var(--gold); }
.input::placeholder { color:var(--muted); font-weight:400; }
select.input { cursor:pointer; }

.chips { display:flex; flex-wrap:wrap; gap:7px; margin-bottom:12px; }
.chip {
  padding:6px 11px; font-size:12px; font-weight:700;
  background:rgba(255,215,0,.08);
  border:1px solid rgba(255,215,0,.28);
  border-radius:20px; color:var(--gold);
  cursor:pointer; transition:all .18s;
  font-family:"Be Vietnam Pro",sans-serif; user-select:none;
}
.chip:active { background:rgba(255,215,0,.25); transform:scale(.96); }

.btn-gold {
  width:100%; padding:13px;
  background:linear-gradient(135deg,#FFD700,#FFA500);
  border:none; border-radius:12px;
  font-family:"Be Vietnam Pro",sans-serif;
  font-size:15px; font-weight:800;
  color:#5C0000; cursor:pointer;
  box-shadow:0 4px 18px rgba(255,165,0,.32);
  transition:all .2s; position:relative; overflow:hidden;
  letter-spacing:.3px;
}
.btn-gold::before {
  content:""; position:absolute; inset:0;
  background:linear-gradient(180deg,rgba(255,255,255,.18) 0%,transparent 55%);
}
.btn-gold:active { transform:scale(.98); }
.btn-ghost {
  padding:9px 15px;
  background:transparent;
  border:1px solid var(--border);
  border-radius:9px; color:var(--muted);
  font-family:"Be Vietnam Pro",sans-serif;
  font-size:12px; font-weight:600;
  cursor:pointer; transition:all .2s;
}
.btn-ghost:hover { border-color:var(--gold); color:var(--gold); }
.btn-del {
  width:28px; height:28px;
  background:rgba(255,60,60,.1); border:1px solid rgba(255,80,80,.3);
  border-radius:8px; color:rgba(255,120,120,.8);
  font-size:13px; cursor:pointer;
  display:flex; align-items:center; justify-content:center;
  transition:all .2s; flex-shrink:0;
}
.btn-del:active { background:rgba(255,60,60,.25); }

/* â”€â”€ LIST â”€â”€ */
.list { display:flex; flex-direction:column; gap:8px; }
.li-item {
  background:rgba(0,0,0,.32); border:1px solid var(--border);
  border-radius:12px; padding:10px 12px;
  display:flex; align-items:center; gap:10px;
  animation:slideIn .28s ease;
}
@keyframes slideIn {
  from { opacity:0; transform:translateY(-8px); }
  to   { opacity:1; transform:translateY(0); }
}
.li-icon {
  width:36px; height:36px; flex-shrink:0;
  background:linear-gradient(135deg,#C00020,#700012);
  border:1px solid rgba(255,215,0,.3);
  border-radius:9px; display:flex; align-items:center; justify-content:center;
  font-size:17px;
}
.li-info { flex:1; min-width:0; }
.li-name { font-size:13px; font-weight:600; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.li-time { font-size:10px; color:var(--muted); margin-top:2px; }
.li-amount { font-size:15px; font-weight:800; color:var(--gold); flex-shrink:0; }
.empty { text-align:center; padding:32px 0; color:var(--muted); }
.empty-ico { font-size:42px; margin-bottom:10px; opacity:.4; }
.empty-txt { font-size:13px; }

/* â”€â”€ STATS â”€â”€ */
.stats-grid { display:grid; grid-template-columns:1fr 1fr; gap:9px; margin-bottom:11px; }
.stat {
  background:var(--surface); border:1px solid var(--border);
  border-radius:var(--radius); padding:14px 11px; text-align:center;
}
.stat-val { font-size:20px; font-weight:800; color:var(--gold); }
.stat-lbl { font-size:10px; color:var(--muted); margin-top:3px; }

.chart {}
.ch-row { display:flex; align-items:center; gap:8px; margin-bottom:7px; }
.ch-lbl { font-size:10px; color:var(--muted); width:68px; flex-shrink:0; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.ch-track { flex:1; height:14px; background:rgba(255,255,255,.06); border-radius:7px; overflow:hidden; }
.ch-bar { height:100%; border-radius:7px; background:linear-gradient(90deg,#b8860b,var(--gold)); min-width:5px; transition:width .6s; }
.ch-val { font-size:10px; font-weight:700; color:var(--gold); width:50px; text-align:right; flex-shrink:0; }

/* â”€â”€ WHEEL â”€â”€ */
.wheel-section { display:flex; flex-direction:column; align-items:center; }
.wheel-ptr { width:0; height:0; border-left:11px solid transparent; border-right:11px solid transparent; border-top:19px solid var(--gold); margin-bottom:-3px; filter:drop-shadow(0 2px 4px rgba(255,215,0,.5)); z-index:5; }
.wheel-wrap { position:relative; width:260px; height:260px; }
#wcanvas { border-radius:50%; box-shadow:0 0 30px rgba(255,215,0,.18),0 8px 28px rgba(0,0,0,.55); }
.wheel-btn {
  position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  width:46px; height:46px;
  background:linear-gradient(135deg,#FFD700,#FFA500);
  border-radius:50%; border:3px solid #fff;
  display:flex; align-items:center; justify-content:center;
  font-size:18px; cursor:pointer;
  box-shadow:0 0 16px rgba(255,215,0,.55);
  z-index:6; user-select:none; transition:transform .15s;
}
.wheel-btn:active { transform:translate(-50%,-50%) scale(.94); }
.wheel-result { margin-top:14px; text-align:center; font-size:17px; font-weight:700; color:var(--gold); min-height:26px; }

/* â”€â”€ WISHES â”€â”€ */
.envelope-btn {
  width:88px; height:115px;
  background:linear-gradient(160deg,#CC0018,#800012);
  border:2px solid var(--gold); border-radius:10px;
  margin:4px auto 14px; display:flex; align-items:center; justify-content:center;
  font-size:44px; cursor:pointer;
  box-shadow:0 0 22px rgba(255,215,0,.18);
  transition:all .2s; animation:envPulse 2.4s ease-in-out infinite;
  position:relative; overflow:hidden;
}
.envelope-btn::before {
  content:""; position:absolute;
  top:0;left:0;right:0; height:44%;
  background:linear-gradient(180deg,rgba(255,255,255,.07),transparent);
  border-bottom:1px solid rgba(255,215,0,.2);
}
@keyframes envPulse {
  0%,100% { box-shadow:0 0 22px rgba(255,215,0,.18); }
  50%      { box-shadow:0 0 36px rgba(255,215,0,.48); }
}
.envelope-btn:active { transform:scale(.95); }
.wish-box {
  background:rgba(0,0,0,.38); border:1px solid var(--border);
  border-radius:12px; padding:15px; text-align:center; font-size:15px;
  font-weight:600; line-height:1.65; min-height:58px; color:var(--gold-soft);
  transition:all .3s; font-style:italic;
}
.wish-count { text-align:center; font-size:10px; color:var(--muted); margin-top:7px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Tá»¬ VI STYLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tuvi-hero {
  background:linear-gradient(145deg, rgba(180,0,24,0.5), rgba(60,0,10,0.8));
  border:2px solid var(--gold); border-radius:18px;
  padding:20px 16px; text-align:center; margin-bottom:11px;
  position:relative; overflow:hidden;
}
.tuvi-hero::before {
  content:"â˜¯"; position:absolute;
  font-size:110px; opacity:.04;
  top:-10px; left:50%; transform:translateX(-50%);
  pointer-events:none;
}
.tuvi-zodiac { font-size:56px; margin-bottom:6px; }
.tuvi-name { font-family:"Playfair Display",serif; font-size:24px; color:var(--gold); font-weight:800; }
.tuvi-sub { font-size:12px; color:var(--muted); margin-top:4px; letter-spacing:1px; }
.tuvi-badges { display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-top:12px; }
.badge {
  padding:5px 12px; font-size:11px; font-weight:700;
  background:rgba(255,215,0,.12); border:1px solid rgba(255,215,0,.3);
  border-radius:20px; color:var(--gold-soft);
}

.tuvi-section { margin-bottom:11px; }
.tuvi-grid { display:grid; grid-template-columns:1fr 1fr; gap:8px; }
.tuvi-box {
  background:rgba(0,0,0,.35); border:1px solid var(--border);
  border-radius:12px; padding:12px 10px; text-align:center;
}
.tuvi-box-ico { font-size:24px; margin-bottom:5px; }
.tuvi-box-lbl { font-size:9px; color:var(--muted); letter-spacing:1px; text-transform:uppercase; margin-bottom:3px; }
.tuvi-box-val { font-size:13px; font-weight:700; color:var(--gold-soft); line-height:1.4; }

.star-row { display:flex; gap:3px; justify-content:center; margin-top:6px; }
.star { font-size:14px; }

.fortune-block {
  background:rgba(0,0,0,.3); border-left:3px solid var(--gold);
  border-radius:0 10px 10px 0; padding:12px 14px;
  margin-bottom:9px; font-size:13px; line-height:1.7;
  color:var(--text);
}
.fortune-block strong { color:var(--gold); }

.aspect-pill {
  display:inline-flex; align-items:center; gap:5px;
  padding:6px 12px; border-radius:20px;
  font-size:12px; font-weight:700; margin:3px;
}
.pill-good { background:rgba(46,204,113,.15); border:1px solid rgba(46,204,113,.4); color:#2ECC71; }
.pill-bad  { background:rgba(255,80,80,.12);  border:1px solid rgba(255,80,80,.35);  color:#ff8080; }
.pill-ok   { background:rgba(255,215,0,.1);   border:1px solid rgba(255,215,0,.3);   color:var(--gold); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THá»œI TIáº¾T STYLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.weather-hero {
  background:linear-gradient(145deg, rgba(0,40,120,0.6), rgba(0,10,60,0.85));
  border:2px solid rgba(100,160,255,0.4); border-radius:18px;
  padding:20px 16px; text-align:center; margin-bottom:11px;
  position:relative; overflow:hidden;
}
.weather-hero::before {
  content:""; position:absolute; inset:0; pointer-events:none;
  background:radial-gradient(ellipse 80% 60% at 50% -10%, rgba(100,180,255,0.15), transparent);
}
.weather-temp {
  font-family:"Playfair Display",serif;
  font-size:58px; font-weight:800;
  color:#fff; line-height:1;
  text-shadow:0 0 30px rgba(100,180,255,0.5);
}
.weather-icon { font-size:50px; margin-bottom:6px; }
.weather-desc { font-size:14px; color:rgba(200,220,255,0.8); margin-top:5px; font-weight:600; }
.weather-loc { font-size:11px; color:rgba(150,190,255,0.6); margin-top:4px; letter-spacing:2px; text-transform:uppercase; }

.weather-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-bottom:10px; }
.w-box {
  background:rgba(0,20,80,.45); border:1px solid rgba(100,160,255,.2);
  border-radius:12px; padding:12px 8px; text-align:center;
}
.w-box-ico { font-size:20px; margin-bottom:4px; }
.w-box-lbl { font-size:9px; color:rgba(150,190,255,.55); letter-spacing:1px; text-transform:uppercase; margin-bottom:3px; }
.w-box-val { font-size:13px; font-weight:700; color:rgba(200,230,255,.9); }

/* lunar calendar */
.lunar-card {
  background:linear-gradient(145deg, rgba(80,0,16,0.5), rgba(30,0,8,0.8));
  border:1px solid var(--border); border-radius:14px;
  padding:14px; margin-bottom:10px;
}
.lunar-date { font-family:"Playfair Display",serif; font-size:28px; color:var(--gold); text-align:center; font-weight:800; }
.lunar-day  { font-size:11px; color:var(--muted); text-align:center; letter-spacing:1px; margin-top:2px; }
.lunar-row  { display:flex; gap:6px; margin-top:10px; flex-wrap:wrap; justify-content:center; }
.lunar-tag {
  padding:4px 10px; font-size:11px; font-weight:700;
  border-radius:15px; border:1px solid;
}
.tag-good  { background:rgba(46,204,113,.12); border-color:rgba(46,204,113,.35); color:#2ECC71; }
.tag-bad   { background:rgba(255,80,80,.1);   border-color:rgba(255,80,80,.3);   color:#ff8080; }
.tag-gold  { background:rgba(255,215,0,.1);   border-color:rgba(255,215,0,.3);   color:var(--gold); }

.hours-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:6px; }
.hour-box {
  border-radius:10px; padding:8px 6px; text-align:center;
  font-size:10px; border:1px solid;
}
.hour-good { background:rgba(46,204,113,.1); border-color:rgba(46,204,113,.3); color:#2ECC71; }
.hour-bad  { background:rgba(255,80,80,.08); border-color:rgba(255,80,80,.25); color:#ff8080; }
.hour-lbl  { font-weight:800; margin-bottom:2px; font-size:11px; }
.hour-sub  { color:rgba(200,230,200,.5); font-size:9px; }

.sun-row { display:flex; justify-content:center; gap:28px; margin-top:10px; }
.sun-item { text-align:center; }
.sun-ico  { font-size:24px; margin-bottom:4px; }
.sun-time { font-size:17px; font-weight:800; color:var(--gold); }
.sun-lbl  { font-size:10px; color:var(--muted); }

.suggest-item {
  display:flex; align-items:flex-start; gap:10px;
  padding:10px 0; border-bottom:1px solid var(--border);
  font-size:13px; line-height:1.5;
}
.suggest-item:last-child { border-bottom:none; padding-bottom:0; }
.suggest-ico { font-size:20px; flex-shrink:0; margin-top:2px; }

/* loading spinner */
.spinner {
  display:flex; justify-content:center; padding:24px;
}
.spin-ring {
  width:32px; height:32px; border-radius:50%;
  border:3px solid rgba(255,215,0,.15);
  border-top-color:var(--gold);
  animation:spin .8s linear infinite;
}
@keyframes spin { to { transform:rotate(360deg); } }

/* â”€â”€ CONFETTI â”€â”€ */
.cf {
  position:fixed; pointer-events:none; z-index:999;
  border-radius:2px; animation:cfFall linear forwards;
}
@keyframes cfFall {
  0%   { transform:translateY(-10px) rotate(0deg); opacity:1; }
  80%  { opacity:1; }
  100% { transform:translateY(110vh) rotate(900deg); opacity:0; }
}

/* â”€â”€ TOAST â”€â”€ */
.toast {
  position:fixed; bottom:96px; left:50%;
  transform:translateX(-50%) translateY(12px);
  background:rgba(12,0,3,0.96); border:1px solid var(--gold);
  border-radius:30px; padding:8px 20px;
  font-size:13px; font-weight:600; color:var(--gold);
  z-index:999; opacity:0;
  transition:all .28s; pointer-events:none;
  white-space:nowrap; box-shadow:0 4px 20px rgba(0,0,0,.5);
}
.toast.on { opacity:1; transform:translateX(-50%) translateY(0); }

.goal-row { display:flex; gap:8px; align-items:flex-end; }
.goal-row .field { flex:1; margin-bottom:0; }

::-webkit-scrollbar { width:4px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:rgba(255,215,0,.2); border-radius:4px; }
</style>
</head>
<body>
<div class="app">

<!-- HEADER -->
<div class="header">
  <div class="header-title">ğŸ§§ LÃ¬ XÃ¬ 2026</div>
  <div class="header-year">BÃ­nh Ngá» Â· NÄƒm Má»›i</div>
</div>

<!-- â•â•â• TRANG 1: NHáº¬P & Tá»”NG â•â•â• -->
<div class="page on" id="p-home">
  <div class="total-card">
    <div class="total-lbl">Tá»•ng LÃ¬ XÃ¬</div>
    <div class="total-num" id="totalAmt">0 Ä‘</div>
    <div class="total-row">
      <div class="tr-item"><div class="tr-val" id="countBao">0</div><div class="tr-lbl">Phong bÃ¬</div></div>
      <div class="tr-item"><div class="tr-val" id="avgAmt">0 Ä‘</div><div class="tr-lbl">Trung bÃ¬nh</div></div>
      <div class="tr-item"><div class="tr-val" id="maxAmt">0 Ä‘</div><div class="tr-lbl">Nhiá»u nháº¥t</div></div>
    </div>
    <div class="prog-wrap" id="progWrap" style="display:none">
      <div class="prog-hd"><span>Má»¥c tiÃªu</span><strong id="progPct">0%</strong></div>
      <div class="prog-track"><div class="prog-fill" id="progFill" style="width:0%"></div></div>
    </div>
  </div>

  <div class="card">
    <div class="card-hd">â• ThÃªm phong bÃ¬</div>
    <div class="field">
      <label>Ai cho</label>
      <input class="input" id="inName" placeholder="VÃ­ dá»¥: BÃ  ngoáº¡i, ChÃº TÆ°â€¦" type="text" maxlength="40">
    </div>
    <div class="field">
      <label>Sá»‘ tiá»n (Ä‘)</label>
      <input class="input" id="inAmt" placeholder="Nháº­p sá»‘ tiá»nâ€¦" type="text" inputmode="numeric" autocomplete="off">
    </div>
    <div class="chips" id="quickChips">
      <div class="chip" data-val="50000">50k</div>
      <div class="chip" data-val="100000">100k</div>
      <div class="chip" data-val="200000">200k</div>
      <div class="chip" data-val="500000">500k</div>
      <div class="chip" data-val="1000000">1tr</div>
      <div class="chip" data-val="2000000">2tr</div>
    </div>
    <button class="btn-gold" onclick="addEntry()">ğŸ§§ ThÃªm vÃ o</button>
  </div>

  <div class="card">
    <div class="card-hd" style="justify-content:space-between">
      <span>ğŸ“‹ Danh sÃ¡ch</span>
      <button class="btn-ghost" onclick="clearAll()">XoÃ¡ háº¿t</button>
    </div>
    <div id="listWrap">
      <div class="empty"><div class="empty-ico">ğŸ§§</div><div class="empty-txt">ChÆ°a cÃ³ lÃ¬ xÃ¬ nÃ o.<br>ThÃªm phong bÃ¬ Ä‘áº§u tiÃªn thÃ´i!</div></div>
    </div>
  </div>
</div>

<!-- â•â•â• TRANG 2: Má»¤C TIÃŠU â•â•â• -->
<div class="page" id="p-goal">
  <div class="card">
    <div class="card-hd">ğŸ¯ Äáº·t má»¥c tiÃªu</div>
    <div class="goal-row">
      <div class="field">
        <label>Má»¥c tiÃªu (Ä‘)</label>
        <input class="input" id="inGoal" placeholder="VÃ­ dá»¥: 5000000" type="text" inputmode="numeric" autocomplete="off">
      </div>
      <button class="btn-ghost" style="margin-bottom:1px" onclick="setGoal()">LÆ°u</button>
    </div>
    <div class="chips">
      <div class="chip" data-goal="1000000">1tr</div>
      <div class="chip" data-goal="2000000">2tr</div>
      <div class="chip" data-goal="5000000">5tr</div>
      <div class="chip" data-goal="10000000">10tr</div>
    </div>
    <div id="goalStatus" style="font-size:14px;line-height:1.7;color:var(--text-dim);text-align:center;padding:10px 0">ChÆ°a Ä‘áº·t má»¥c tiÃªu.</div>
  </div>
  <div class="card">
    <div class="card-hd">ğŸ’¸ Dá»± tÃ­nh chi tiÃªu</div>
    <p style="font-size:13px;color:var(--muted);margin-bottom:12px">ThÃªm khoáº£n muá»‘n mua / dÃ¹ng tá»« tiá»n lÃ¬ xÃ¬</p>
    <div style="display:flex;gap:8px;margin-bottom:10px">
      <input class="input" id="inSpendName" placeholder="Mua gÃ¬â€¦" style="flex:1">
      <input class="input" id="inSpendAmt" placeholder="Tiá»n" type="text" inputmode="numeric" autocomplete="off" style="width:95px">
    </div>
    <button class="btn-gold" onclick="addSpend()" style="margin-bottom:12px">ThÃªm khoáº£n</button>
    <div id="spendList"></div>
    <div id="spendSummary" style="margin-top:10px;font-size:13px;color:var(--muted);text-align:center"></div>
  </div>
</div>

<!-- â•â•â• TRANG 3: THá»NG KÃŠ â•â•â• -->
<div class="page" id="p-stats">
  <div class="stats-grid">
    <div class="stat"><div class="stat-val" id="stTotal">0 Ä‘</div><div class="stat-lbl">Tá»•ng nháº­n</div></div>
    <div class="stat"><div class="stat-val" id="stCount">0</div><div class="stat-lbl">Phong bÃ¬</div></div>
    <div class="stat"><div class="stat-val" id="stAvg">0 Ä‘</div><div class="stat-lbl">Trung bÃ¬nh</div></div>
    <div class="stat"><div class="stat-val" id="stMax">0 Ä‘</div><div class="stat-lbl">Cao nháº¥t</div></div>
  </div>
  <div class="card">
    <div class="card-hd">ğŸ“Š Top ngÆ°á»i cho nhiá»u nháº¥t</div>
    <div id="chartWrap"><div class="empty-txt" style="color:var(--muted);text-align:center;padding:16px">ChÆ°a cÃ³ dá»¯ liá»‡u</div></div>
  </div>
  <div class="card">
    <div class="card-hd">ğŸ† Lá»i Ä‘á»™ng viÃªn</div>
    <div id="motiveTxt" style="font-size:14px;line-height:1.7;text-align:center;color:var(--gold-soft);font-style:italic;padding:4px 0">HÃ£y thÃªm phong bÃ¬ Ä‘á»ƒ xem nháº­n xÃ©t!</div>
  </div>
</div>

<!-- â•â•â• TRANG 4: VUI Váºº â•â•â• -->
<div class="page" id="p-fun">
  <div class="card">
    <div class="card-hd">ğŸ’Œ Lá»i chÃºc ngáº«u nhiÃªn</div>
    <div class="envelope-btn" onclick="getWish()">ğŸ§§</div>
    <div class="wish-box" id="wishBox">Báº¥m vÃ o phong bÃ¬ Ä‘á»ƒ nháº­n lá»i chÃºc âœ¨</div>
    <div class="wish-count" id="wishCount"></div>
  </div>
  <div class="card">
    <div class="card-hd">ğŸ¡ VÃ²ng quay may máº¯n</div>
    <p style="font-size:12px;color:var(--muted);margin-bottom:14px">Quay Ä‘á»ƒ biáº¿t hÃ´m nay may máº¯n cá»¡ nÃ o ğŸ‘€</p>
    <div class="wheel-section">
      <div class="wheel-ptr"></div>
      <div class="wheel-wrap">
        <canvas id="wcanvas" width="260" height="260"></canvas>
        <div class="wheel-btn" onclick="spinWheel()">ğŸ²</div>
      </div>
      <div class="wheel-result" id="wheelResult"></div>
    </div>
  </div>
</div>

<!-- â•â•â• TRANG 5: Tá»¬ VI â•â•â• -->
<div class="page" id="p-tuvi">
  <!-- nháº­p nÄƒm -->
  <div class="card">
    <div class="card-hd">ğŸ”® Xem tá»­ vi 2026</div>
    <div class="field">
      <label>NÄƒm sinh dÆ°Æ¡ng lá»‹ch</label>
      <input class="input" id="inBirthYear" placeholder="VÃ­ dá»¥: 1998" type="number" min="1900" max="2025" inputmode="numeric">
    </div>
    <div class="field">
      <label>Giá»›i tÃ­nh</label>
      <select class="input" id="inGender">
        <option value="nam">Nam</option>
        <option value="nu">Ná»¯</option>
      </select>
    </div>
    <button class="btn-gold" onclick="calcTuvi()">ğŸ”® Xem tá»­ vi nÄƒm 2026</button>
  </div>
  <div id="tuviResult"></div>
</div>

<!-- â•â•â• TRANG 6: THá»œI TIáº¾T â•â•â• -->
<div class="page" id="p-weather">
  <!-- chá»n tá»‰nh -->
  <div class="card">
    <div class="card-hd">ğŸŒ¤ï¸ Chá»n tá»‰nh thÃ nh</div>
    <div class="field">
      <label>Tá»‰nh / ThÃ nh phá»‘</label>
      <select class="input" id="provSelect" onchange="loadWeather()">
        <option value="">-- Chá»n tá»‰nh thÃ nh --</option>
      </select>
    </div>
    <div style="display:flex;gap:8px;margin-top:4px">
      <button class="btn-ghost" style="flex:1" onclick="locateMe()">ğŸ“ Vá»‹ trÃ­ cá»§a tÃ´i</button>
      <button class="btn-ghost" style="flex:1" onclick="loadWeather()">ğŸ”„ LÃ m má»›i</button>
    </div>
  </div>
  <div id="weatherResult"></div>
</div>

</div><!-- /app -->

<!-- BOTTOM NAV -->
<div class="bnav">
  <div class="tab on"  data-page="p-home"    onclick="switchTab(this)"><span>ğŸ </span>Nháº­p</div>
  <div class="tab"     data-page="p-goal"    onclick="switchTab(this)"><span>ğŸ¯</span>Má»¥c tiÃªu</div>
  <div class="tab"     data-page="p-stats"   onclick="switchTab(this)"><span>ğŸ“Š</span>Thá»‘ng kÃª</div>
  <div class="tab"     data-page="p-fun"     onclick="switchTab(this)"><span>ğŸ¡</span>Vui váº»</div>
  <div class="tab"     data-page="p-tuvi"    onclick="switchTab(this)"><span>ğŸ”®</span>Tá»­ vi</div>
  <div class="tab"     data-page="p-weather" onclick="switchTab(this)"><span>ğŸŒ¤ï¸</span>Thá»i tiáº¿t</div>
</div>

<div class="toast" id="toast"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let appData = {entries:[], goal:0, spends:[]};
try { appData = JSON.parse(localStorage.getItem('lixi26') || '{"entries":[],"goal":0,"spends":[]}'); } catch(e){}
function save() { try { localStorage.setItem('lixi26', JSON.stringify(appData)); } catch(e){} }

function fmt(n) {
  if (n >= 1_000_000) return (n/1_000_000).toFixed(n%1_000_000===0?0:1) + ' tr';
  if (n >= 1_000)     return (n/1_000).toFixed(n%1_000===0?0:1) + 'k';
  return n.toLocaleString('vi') + ' Ä‘';
}
function fmtFull(n) { return n.toLocaleString('vi') + ' Ä‘'; }
function timeStr(ts) {
  const d = new Date(ts);
  return `${d.getDate()}/${d.getMonth()+1} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function switchTab(el) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('on'));
  document.querySelectorAll('.page').forEach(p => p.classList.remove('on'));
  document.querySelectorAll(`[data-page="${el.dataset.page}"]`).forEach(t => t.classList.add('on'));
  document.getElementById(el.dataset.page).classList.add('on');
  if (el.dataset.page === 'p-stats')   renderStats();
  if (el.dataset.page === 'p-goal')    renderGoalPage();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHIPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORMAT Sá» TIá»€N â€“ cá»© 3 chá»¯ sá»‘ thÃªm dáº¥u cháº¥m
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function numFmtInput(val) {
  // Chá»‰ giá»¯ láº¡i chá»¯ sá»‘
  const raw = val.replace(/\D/g, '');
  if (!raw) return '';
  // ThÃªm dáº¥u cháº¥m má»—i 3 chá»¯ sá»‘
  return raw.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
}
function numParseInput(val) {
  return parseFloat(val.replace(/\./g, '')) || 0;
}
function bindMoneyInput(id) {
  const el = document.getElementById(id);
  if (!el) return;
  el.addEventListener('input', function() {
    const pos = this.selectionStart;
    const oldLen = this.value.length;
    this.value = numFmtInput(this.value);
    // Giá»¯ vá»‹ trÃ­ con trá»
    const newLen = this.value.length;
    this.setSelectionRange(pos + newLen - oldLen, pos + newLen - oldLen);
  });
  el.addEventListener('keydown', function(e) {
    // Cho phÃ©p: sá»‘, dáº¥u cháº¥m (tá»± thÃªm), backspace, delete, arrow, tab, enter
    if (e.key === 'Enter') return;
    if (['Backspace','Delete','ArrowLeft','ArrowRight','Tab','Home','End'].includes(e.key)) return;
    if (e.ctrlKey || e.metaKey) return;
    // Chá»‰ nháº­n chá»¯ sá»‘
    if (!/^\d$/.test(e.key)) e.preventDefault();
  });
}
bindMoneyInput('inAmt');
bindMoneyInput('inGoal');
bindMoneyInput('inSpendAmt');

document.querySelectorAll('#quickChips .chip').forEach(c => {
  c.addEventListener('click', () => {
    document.getElementById('inAmt').value = numFmtInput(c.dataset.val);
  });
});
document.querySelectorAll('[data-goal]').forEach(c => {
  c.addEventListener('click', () => {
    document.getElementById('inGoal').value = numFmtInput(c.dataset.goal);
    setGoal();
  });
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LÃŒ XÃŒ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function addEntry() {
  const nameRaw = document.getElementById('inName').value.trim();
  const amtRaw  = numParseInput(document.getElementById('inAmt').value);
  if (!amtRaw || amtRaw <= 0) { toast('Nháº­p sá»‘ tiá»n trÆ°á»›c nha!'); return; }
  const name = nameRaw || 'KhÃ´ng rÃµ';
  appData.entries.unshift({ id:Date.now(), name, amt:amtRaw, ts:Date.now() });
  save(); document.getElementById('inName').value=''; document.getElementById('inAmt').value='';
  renderHome(); confetti(); toast(`ğŸ§§ +${fmt(amtRaw)} tá»« ${name}`);
}

function renderHome() {
  const entries = appData.entries;
  const total = entries.reduce((s,e)=>s+e.amt,0);
  const count = entries.length;
  const avg   = count ? Math.round(total/count) : 0;
  const max   = count ? Math.max(...entries.map(e=>e.amt)) : 0;
  document.getElementById('totalAmt').textContent = fmtFull(total);
  document.getElementById('countBao').textContent = count;
  document.getElementById('avgAmt').textContent   = fmt(avg);
  document.getElementById('maxAmt').textContent   = fmt(max);
  const pw = document.getElementById('progWrap');
  if (appData.goal > 0) {
    pw.style.display = 'block';
    const pct = Math.min(100, Math.round(total/appData.goal*100));
    document.getElementById('progPct').textContent  = pct+'%';
    document.getElementById('progFill').style.width = pct+'%';
  } else { pw.style.display='none'; }
  const wrap = document.getElementById('listWrap');
  if (!count) {
    wrap.innerHTML=`<div class="empty"><div class="empty-ico">ğŸ§§</div><div class="empty-txt">ChÆ°a cÃ³ lÃ¬ xÃ¬ nÃ o.<br>ThÃªm phong bÃ¬ Ä‘áº§u tiÃªn thÃ´i!</div></div>`;
    return;
  }
  wrap.innerHTML=`<div class="list">${entries.map(e=>`
    <div class="li-item" id="li-${e.id}">
      <div class="li-icon">ğŸ§§</div>
      <div class="li-info"><div class="li-name">${e.name}</div><div class="li-time">${timeStr(e.ts)}</div></div>
      <div class="li-amount">${fmtFull(e.amt)}</div>
      <button class="btn-del" onclick="delEntry(${e.id})">âœ•</button>
    </div>`).join('')}</div>`;
}
function delEntry(id) { appData.entries=appData.entries.filter(e=>e.id!==id); save(); renderHome(); toast('ÄÃ£ xoÃ¡'); }
function clearAll() {
  if (!appData.entries.length) { toast('ChÆ°a cÃ³ gÃ¬ Ä‘á»ƒ xoÃ¡!'); return; }
  if (confirm('XoÃ¡ háº¿t danh sÃ¡ch lÃ¬ xÃ¬?')) { appData.entries=[]; save(); renderHome(); toast('ÄÃ£ xoÃ¡ háº¿t'); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GOAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setGoal() {
  const v = numParseInput(document.getElementById('inGoal').value);
  if (!v||v<=0) { toast('Nháº­p sá»‘ tiá»n má»¥c tiÃªu!'); return; }
  appData.goal=v; save(); renderHome(); renderGoalPage(); toast('ğŸ¯ ÄÃ£ lÆ°u má»¥c tiÃªu!');
}
function renderGoalPage() {
  const total = appData.entries.reduce((s,e)=>s+e.amt,0);
  const g = appData.goal;
  const el = document.getElementById('goalStatus');
  if (!g) { el.innerHTML='ChÆ°a Ä‘áº·t má»¥c tiÃªu.'; return; }
  const pct = Math.min(100, Math.round(total/g*100));
  const left = Math.max(0, g-total);
  let msg='';
  if (pct>=100) msg='ğŸ‰ ÄÃ£ Ä‘áº¡t má»¥c tiÃªu rá»“i! Xuáº¥t sáº¯c!';
  else if (pct>=75) msg=`ğŸ”¥ Gáº§n rá»“i! CÃ²n ${fmtFull(left)} ná»¯a thÃ´i!`;
  else if (pct>=50) msg=`ğŸ’ª ÄÆ°á»£c má»™t ná»­a rá»“i! CÃ²n ${fmtFull(left)} ná»¯a.`;
  else if (pct>0)   msg=`ğŸŒ± Äang trÃªn Ä‘Æ°á»ngâ€¦ CÃ²n thiáº¿u ${fmtFull(left)}.`;
  else msg=`ğŸš€ Báº¯t Ä‘áº§u thÃ´i! Má»¥c tiÃªu: ${fmtFull(g)}`;
  el.innerHTML=`<strong style="color:var(--gold);font-size:22px">${pct}%</strong><br>${msg}`;
  renderHome(); renderSpends();
}
function addSpend() {
  const n=document.getElementById('inSpendName').value.trim();
  const a=numParseInput(document.getElementById('inSpendAmt').value);
  if (!n||!a||a<=0){toast('Äiá»n tÃªn & sá»‘ tiá»n!');return;}
  appData.spends.push({id:Date.now(),name:n,amt:a}); save(); renderSpends();
  document.getElementById('inSpendName').value=''; document.getElementById('inSpendAmt').value='';
}
function renderSpends() {
  const el=document.getElementById('spendList');
  const sm=document.getElementById('spendSummary');
  if(!appData.spends.length){el.innerHTML='';sm.textContent='';return;}
  const totalSpend=appData.spends.reduce((s,x)=>s+x.amt,0);
  const total=appData.entries.reduce((s,e)=>s+e.amt,0);
  const remain=total-totalSpend;
  el.innerHTML=`<div class="list">${appData.spends.map(x=>`
    <div class="li-item" style="padding:9px 12px">
      <div class="li-icon" style="font-size:14px;width:32px;height:32px;border-radius:7px">ğŸ’¸</div>
      <div class="li-info"><div class="li-name">${x.name}</div></div>
      <div class="li-amount" style="font-size:13px">${fmtFull(x.amt)}</div>
      <button class="btn-del" onclick="delSpend(${x.id})">âœ•</button>
    </div>`).join('')}</div>`;
  sm.innerHTML=`Tá»•ng chi: <strong style="color:#ff8080">${fmtFull(totalSpend)}</strong> &nbsp;|&nbsp; CÃ²n láº¡i: <strong style="color:${remain>=0?'#2ECC71':'#ff6060'}">${fmtFull(remain)}</strong>`;
}
function delSpend(id) { appData.spends=appData.spends.filter(x=>x.id!==id); save(); renderSpends(); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderStats() {
  const entries=appData.entries;
  const total=entries.reduce((s,e)=>s+e.amt,0);
  const count=entries.length;
  const avg=count?Math.round(total/count):0;
  const max=count?Math.max(...entries.map(e=>e.amt)):0;
  document.getElementById('stTotal').textContent=fmt(total);
  document.getElementById('stCount').textContent=count;
  document.getElementById('stAvg').textContent=fmt(avg);
  document.getElementById('stMax').textContent=fmt(max);
  const cw=document.getElementById('chartWrap');
  if (!count) { cw.innerHTML=`<div class="empty-txt" style="color:var(--muted);text-align:center;padding:16px">ChÆ°a cÃ³ dá»¯ liá»‡u</div>`; }
  else {
    const map={};
    entries.forEach(e=>{map[e.name]=(map[e.name]||0)+e.amt;});
    const sorted=Object.entries(map).sort((a,b)=>b[1]-a[1]).slice(0,8);
    const topVal=sorted[0][1];
    cw.innerHTML=`<div class="chart">${sorted.map(([name,val])=>`
      <div class="ch-row">
        <div class="ch-lbl" title="${name}">${name}</div>
        <div class="ch-track"><div class="ch-bar" style="width:${Math.round(val/topVal*100)}%"></div></div>
        <div class="ch-val">${fmt(val)}</div>
      </div>`).join('')}</div>`;
  }
  const mt=document.getElementById('motiveTxt');
  if (!count) { mt.textContent='HÃ£y thÃªm phong bÃ¬ Ä‘á»ƒ xem nháº­n xÃ©t!'; }
  else {
    const motives=[
      total>=5_000_000?`ğŸ¤‘ Wow ${fmt(total)}! NÄƒm nay lÃ¬ xÃ¬ khá»§ng quÃ¡!`:null,
      total>=2_000_000&&total<5_000_000?`ğŸ‰ ${fmt(total)} â€” khÃ´ng tá»‡ chÃºt nÃ o! TiÃªu khÃ´n thÃ´i nhÃ©.`:null,
      total<500_000&&count>0?`ğŸ˜„ Má»›i báº¯t Ä‘áº§u thÃ´i, nÄƒm nay sáº½ nhiá»u hÆ¡n!`:null,
      count>=10?`ğŸ’Œ ${count} phong bÃ¬ â€” Ä‘Æ°á»£c yÃªu thÆ°Æ¡ng nhiá»u láº¯m Ä‘áº¥y!`:null,
      avg>=500_000?`âœ¨ Má»—i phong bÃ¬ trung bÃ¬nh ${fmt(avg)} â€” má»«ng cho báº¡n!`:null,
    ].filter(Boolean);
    mt.textContent=motives[Math.floor(Math.random()*motives.length)]||`ğŸ§§ ${count} phong bÃ¬, tá»•ng ${fmt(total)} â€” khÃ´ng sai!`;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Lá»œI CHÃšC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const WISHES=[
  "ğŸŒ¸ ChÃºc báº¡n vÃ  gia Ä‘Ã¬nh nÄƒm má»›i an khang thá»‹nh vÆ°á»£ng!",
  "ğŸŒŸ ChÃºc váº¡n sá»± nhÆ° Ã½, má»i Ä‘iá»u hanh thÃ´ng suÃ´n sáº»!",
  "ğŸ€ ChÃºc nÄƒm má»›i trÃ n Ä‘áº§y may máº¯n vÃ  háº¡nh phÃºc!",
  "ğŸ’° ChÃºc tÃ i lá»™c dá»“i dÃ o, phÃº quÃ½ trÃ n Ä‘áº§y!",
  "ğŸ¯ ChÃºc má»i dá»± Ä‘á»‹nh Ä‘á»u thÃ nh hiá»‡n thá»±c tá»‘t Ä‘áº¹p!",
  "ğŸ’‘ ChÃºc háº¡nh phÃºc viÃªn mÃ£n, gia Ä‘Ã¬nh sum váº§y!",
  "ğŸ“š ChÃºc há»c táº­p tiáº¿n bá»™, sá»± nghiá»‡p thÄƒng tiáº¿n!",
  "ğŸ•Šï¸ ChÃºc bÃ¬nh an tá»« Ä‘áº§u Ä‘áº¿n cuá»‘i nÄƒm!",
  "ğŸŒº ChÃºc xuÃ¢n sang phÃºc Ä‘áº¿n, mÃ£i tÆ°Æ¡i nhÆ° hoa!",
  "â­ ChÃºc sá»©c khá»e dá»“i dÃ o, trÆ°á»ng thá» váº¡n niÃªn!",
  "ğŸ¡ ChÃºc gia Ä‘Ã¬nh áº¥m Ãªm, thuáº­n hoÃ  yÃªu thÆ°Æ¡ng!",
  "ğŸš€ ChÃºc nÄƒm má»›i bá»©t phÃ¡, Ä‘áº¡t Ä‘Æ°á»£c má»i má»¥c tiÃªu!",
  "ğŸŠ ChÃºc má»i khÃ³ khÄƒn tiÃªu tan, Ä‘iá»u tá»‘t Ã¹a vá»!",
  "ğŸŒˆ ChÃºc cuá»™c sá»‘ng rá»±c rá»¡ nhÆ° ngÃ n tia náº¯ng xuÃ¢n!",
  "ğŸ’ ChÃºc báº¡n luÃ´n lÃ  phiÃªn báº£n tá»‘t nháº¥t cá»§a mÃ¬nh!",
];
let wishUsed=0;
function getWish(){
  const box=document.getElementById('wishBox');
  box.style.opacity='0';
  setTimeout(()=>{
    wishUsed++;
    box.textContent=WISHES[Math.floor(Math.random()*WISHES.length)];
    box.style.opacity='1';
    document.getElementById('wishCount').textContent=`ÄÃ£ nháº­n ${wishUsed} lá»i chÃºc âœ¨`;
  },200);
  confetti();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VÃ’NG QUAY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const SECTORS=[
  {label:'Äáº¡i cÃ¡t âœ¨',color:'#B8001A'},{label:'BÃ¬nh an ğŸ•Šï¸',color:'#8B0000'},
  {label:'PhÃº quÃ½ ğŸ’°',color:'#C00020'},{label:'Hanh thÃ´ng ğŸŒŸ',color:'#700010'},
  {label:'Vui váº» ğŸ˜„',color:'#A00018'},{label:'May máº¯n ğŸ€',color:'#600010'},
  {label:'Sá»©c khoáº» ğŸ’ª',color:'#900016'},{label:'TÃ i lá»™c ğŸ‰',color:'#5C000E'},
];
let wheelAngle=0, spinning=false;
function drawWheel(angle){
  const canvas=document.getElementById('wcanvas');
  if(!canvas)return;
  const ctx=canvas.getContext('2d');
  const cx=130,cy=130,r=128,slice=(2*Math.PI)/SECTORS.length;
  ctx.clearRect(0,0,260,260);
  SECTORS.forEach((s,i)=>{
    const start=angle+i*slice,end=start+slice;
    ctx.beginPath();ctx.moveTo(cx,cy);ctx.arc(cx,cy,r,start,end);ctx.closePath();
    ctx.fillStyle=s.color;ctx.fill();
    ctx.strokeStyle='rgba(255,215,0,0.35)';ctx.lineWidth=1.5;ctx.stroke();
    ctx.save();ctx.translate(cx,cy);ctx.rotate(start+slice/2);
    ctx.textAlign='right';ctx.fillStyle='#FFE8A0';
    ctx.font='bold 11px "Be Vietnam Pro",sans-serif';
    ctx.fillText(s.label,r-8,4);ctx.restore();
  });
  ctx.beginPath();ctx.arc(cx,cy,r,0,2*Math.PI);
  ctx.strokeStyle='rgba(255,215,0,0.55)';ctx.lineWidth=3;ctx.stroke();
  ctx.beginPath();ctx.arc(cx,cy,22,0,2*Math.PI);
  ctx.fillStyle='#1a0005';ctx.fill();
  ctx.strokeStyle='rgba(255,215,0,0.4)';ctx.lineWidth=2;ctx.stroke();
}
function spinWheel(){
  if(spinning)return; spinning=true;
  document.getElementById('wheelResult').textContent='';
  const extra=Math.random()*360+720+360*Math.floor(Math.random()*4+3);
  const target=wheelAngle+extra*(Math.PI/180);
  const dur=3200,start=performance.now(),from=wheelAngle;
  function easeOut(t){return 1-Math.pow(1-t,3.5);}
  function step(now){
    const t=Math.min((now-start)/dur,1);
    wheelAngle=from+(target-from)*easeOut(t);
    drawWheel(wheelAngle);
    if(t<1){requestAnimationFrame(step);}
    else{
      wheelAngle=wheelAngle%(2*Math.PI); spinning=false;
      const slice=(2*Math.PI)/SECTORS.length;
      const normalized=((-(wheelAngle-Math.PI/2*3)%(2*Math.PI))+(2*Math.PI))%(2*Math.PI);
      const idx=Math.floor(normalized/slice)%SECTORS.length;
      document.getElementById('wheelResult').textContent=SECTORS[idx].label;
      confetti(); toast('ğŸ¡ '+SECTORS[idx].label);
    }
  }
  requestAnimationFrame(step);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Tá»¬ VI ENGINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const ZODIAC=[
  {name:'TÃ½ ğŸ­',en:'Rat',element:'Thá»§y',yin:1},
  {name:'Sá»­u ğŸ‚',en:'Ox',element:'Thá»•',yin:0},
  {name:'Dáº§n ğŸ¯',en:'Tiger',element:'Má»™c',yin:1},
  {name:'MÃ£o ğŸ°',en:'Rabbit',element:'Má»™c',yin:0},
  {name:'ThÃ¬n ğŸ‰',en:'Dragon',element:'Thá»•',yin:1},
  {name:'Tá»µ ğŸ',en:'Snake',element:'Há»a',yin:0},
  {name:'Ngá» ğŸ',en:'Horse',element:'Há»a',yin:1},
  {name:'MÃ¹i ğŸ‘',en:'Goat',element:'Thá»•',yin:0},
  {name:'ThÃ¢n ğŸ’',en:'Monkey',element:'Kim',yin:1},
  {name:'Dáº­u ğŸ“',en:'Rooster',element:'Kim',yin:0},
  {name:'Tuáº¥t ğŸ•',en:'Dog',element:'Thá»•',yin:1},
  {name:'Há»£i ğŸ—',en:'Pig',element:'Thá»§y',yin:0},
];
const STEM=['GiÃ¡p','áº¤t','BÃ­nh','Äinh','Máº­u','Ká»·','Canh','TÃ¢n','NhÃ¢m','QuÃ½'];
const BRANCH=['TÃ½','Sá»­u','Dáº§n','MÃ£o','ThÃ¬n','Tá»µ','Ngá»','MÃ¹i','ThÃ¢n','Dáº­u','Tuáº¥t','Há»£i'];

// Má»‡nh Náº¡p Ã‚m theo nÄƒm sinh â€“ báº£ng 60 nÄƒm chuáº©n (epoch: 1924 GiÃ¡p TÃ½ = index 0)
const MENH60 = [
  'Kim','Kim',  'Há»a','Há»a',  'Má»™c','Má»™c',  'Thá»•','Thá»•',  'Kim','Kim',   // 0-9:  GiÃ¡pTÃ½â†’NhÃ¢mThÃ¢n
  'Há»a','Há»a',  'Thá»§y','Thá»§y', 'Thá»•','Thá»•',  'Kim','Kim',  'Má»™c','Má»™c',   // 10-19
  'Thá»§y','Thá»§y', 'Thá»•','Thá»•',  'Há»a','Há»a',  'Má»™c','Má»™c', 'Thá»§y','Thá»§y', // 20-29
  'Kim','Kim',   'Há»a','Há»a',  'Má»™c','Má»™c',  'Thá»•','Thá»•', 'Kim','Kim',   // 30-39
  'Há»a','Há»a',  'Thá»§y','Thá»§y', 'Thá»•','Thá»•',  'Kim','Kim', 'Má»™c','Má»™c',   // 40-49
  'Thá»§y','Thá»§y', 'Thá»•','Thá»•',  'Há»a','Há»a',  'Má»™c','Má»™c','Thá»§y','Thá»§y', // 50-59
];
function getMenhBase(year) {
  const s = ((year-4)%10+10)%10;
  const b = ((year-4)%12+12)%12;
  const pos60 = ((year-1924)%60+60)%60;
  return { stem:STEM[s], branch:BRANCH[b], menh:MENH60[pos60], stemFull:STEM[s]+' '+BRANCH[b] };
}
function getZodiac(year) { return ZODIAC[((year+8)%12+12)%12]; }
function getAge(year)    { return 2026-year; }

// Compatibility of zodiac with Horse (Ngá» - year 2026 is BÃ­nh Ngá»)
function getHopeScore(zodIdx){
  // Tam há»£p Ngá»: Dáº§n-Ngá»-Tuáº¥t (indices 2,6,10)  â†’ tá»‘t
  // Lá»¥c há»£p Ngá»: MÃ¹i (index 7) â†’ tá»‘t
  // Xung: TÃ½ (index 0) â†’ xáº¥u
  // Kháº¯c: ThÃ¢n (index 8) â†’ xáº¥u
  if([2,6,10,7].includes(zodIdx)) return 'great';
  if([0,8].includes(zodIdx)) return 'bad';
  return 'ok';
}

// Yearly fortune areas - deterministic based on zodiac index
const FORTUNE_AREAS=['TÃ i lá»™c','Sá»©c khá»e','TÃ¬nh duyÃªn','Sá»± nghiá»‡p','Há»c váº¥n','Gia Ä‘áº¡o'];

function makeFortuneText(zodIdx, year, gender){
  const z=ZODIAC[zodIdx];
  const compat=getHopeScore(zodIdx);
  const age=getAge(year);

  // Create deterministic but varied fortunes
  const seed = zodIdx * 7 + (year % 100);

  const financePhrases=[
    ['TÃ i lá»™c nÄƒm BÃ­nh Ngá» cÃ³ nhiá»u cÆ¡ há»™i sinh lá»£i, Ä‘áº·c biá»‡t ná»­a sau nÄƒm. NÃªn Ä‘áº§u tÆ° tháº­n trá»ng, trÃ¡nh cÃ¡c phi vá»¥ máº¡o hiá»ƒm Ä‘áº§u nÄƒm.','Tiá»n báº¡c tÆ°Æ¡ng Ä‘á»‘i á»•n Ä‘á»‹nh, thu nháº­p Ä‘á»u Ä‘áº·n. CÃ³ thá»ƒ cÃ³ khoáº£n thÆ°á»Ÿng báº¥t ngá». ChÃº Ã½ chi tiÃªu há»£p lÃ½.','NÄƒm nay cÃ³ thá»ƒ cÃ³ biáº¿n Ä‘á»™ng vá» tÃ i chÃ­nh. NÃªn Ä‘á»ƒ dÃ nh Ã­t nháº¥t 20% thu nháº­p, trÃ¡nh vay mÆ°á»£n lá»›n.'],
    0,1,2
  ];

  const healthPhrases=[
    'Sá»©c khá»e nhÃ¬n chung tá»‘t, nhÆ°ng cáº§n chÃº Ã½ Ä‘Æ°á»ng tiÃªu hÃ³a vÃ  huyáº¿t Ã¡p. NÃªn táº­p thá»ƒ dá»¥c Ä‘á»u Ä‘áº·n, ngá»§ Ä‘Ãºng giá».',
    'NÄƒm nay cáº§n chÃº Ã½ sá»©c khá»e tá»•ng thá»ƒ. Äáº·c biá»‡t trÃ¡nh lÃ m viá»‡c quÃ¡ sá»©c vÃ o thÃ¡ng 3-5.',
    'Sá»©c khá»e khÃ¡ tá»‘t, Ã­t á»‘m Ä‘au váº·t. Tuy nhiÃªn nÃªn kiá»ƒm tra sá»©c khá»e Ä‘á»‹nh ká»³ vÃ o Ä‘áº§u nÄƒm.',
  ];

  const lovePhrases={
    nam:[
      'TÃ¬nh duyÃªn sÃ¡ng sá»§a, cÃ³ cÆ¡ há»™i gáº·p ngÆ°á»i há»£p Ã½. NgÆ°á»i Ä‘á»™c thÃ¢n nÃªn chá»§ Ä‘á»™ng hÆ¡n.',
      'Cuá»™c sá»‘ng Ä‘Ã´i lá»©a á»•n Ä‘á»‹nh, Ã­t sÃ³ng giÃ³. NgÆ°á»i cÃ³ ngÆ°á»i yÃªu nÃªn tiáº¿n thÃªm bÆ°á»›c má»›i.',
      'TÃ¬nh cáº£m cáº§n Ä‘Æ°á»£c vun Ä‘áº¯p, trÃ¡nh hiá»ƒu láº§m do giao tiáº¿p. NÄƒm cÃ³ thá»ƒ cÃ³ tin vui gia Ä‘Ã¬nh.',
    ],
    nu:[
      'ÄÃ o hoa nÄƒm Ngá» ná»Ÿ rá»™. NgÆ°á»i Ä‘á»™c thÃ¢n dá»… gáº·p ngÆ°á»i tá»‘t, hÃ£y máº¡nh dáº¡n Ä‘Ã³n nháº­n.',
      'TÃ¬nh cáº£m á»•n Ä‘á»‹nh vÃ  áº¥m Ã¡p. NgÆ°á»i Ä‘Ã£ káº¿t Ä‘Ã´i cÃ³ cÆ¡ há»™i thÃªm thÃ nh viÃªn má»›i.',
      'NÃªn chÃº Ã½ cáº£m xÃºc cá»§a Ä‘á»‘i phÆ°Æ¡ng, trÃ¡nh vÃ¬ cÃ´ng viá»‡c mÃ  xao nhÃ£ng tÃ¬nh cáº£m.',
    ],
  };

  const careerPhrases=[
    'Sá»± nghiá»‡p thÄƒng tiáº¿n rÃµ rá»‡t ná»­a Ä‘áº§u nÄƒm. Dá»… Ä‘Æ°á»£c cáº¥p trÃªn chÃº Ã½ vÃ  tin tÆ°á»Ÿng.',
    'CÃ´ng viá»‡c á»•n Ä‘á»‹nh, cÃ³ thá»ƒ cÃ³ cÆ¡ há»™i chuyá»ƒn sang vá»‹ trÃ­ má»›i tá»‘t hÆ¡n. Náº¯m báº¯t Ä‘Ãºng lÃºc.',
    'Cáº§n cáº©n tháº­n vá»›i Ä‘á»“ng nghiá»‡p vÃ  Ä‘á»‘i tÃ¡c. Giá»¯ vá»¯ng láº­p trÆ°á»ng, trÃ¡nh bá»‹ cuá»‘n vÃ o mÃ¢u thuáº«n ná»™i bá»™.',
  ];

  const fi = seed % 3;
  const hi = (seed+1)%3;
  const li = (seed+2)%3;
  const ci = (seed+3)%3;

  return {
    compat,
    finance: financePhrases[fi] || financePhrases[0],
    health:  healthPhrases[hi],
    love:    (lovePhrases[gender]||lovePhrases.nam)[li],
    career:  careerPhrases[ci],
    luckyNum: [(zodIdx*3+7)%9+1, (zodIdx*5+11)%9+1],
    luckyColor: ['Äá»','VÃ ng','Xanh lam','Tráº¯ng','Xanh lÃ¡'][zodIdx%5],
    luckyDir: ['ÄÃ´ng','TÃ¢y','Nam','Báº¯c','ÄÃ´ng Nam'][zodIdx%5],
    luckyMonth: [(zodIdx+1)%12+1, (zodIdx+7)%12+1].sort((a,b)=>a-b),
    goodMonths: [3,6,9].map(x=>((zodIdx+x)%12+1)),
    badMonths:  [1,4].map(x=>((zodIdx+x)%12+1)),
  };
}

function stars(n){return 'â­'.repeat(n)+'â˜†'.repeat(5-n);}

function calcTuvi(){
  const year=parseInt(document.getElementById('inBirthYear').value);
  const gender=document.getElementById('inGender').value;
  if(!year||year<1900||year>2025){toast('Nháº­p nÄƒm sinh há»£p lá»‡ (1900-2025)!');return;}

  const zodIdx=((year+8)%12+12)%12;
  const zod=ZODIAC[zodIdx];
  const menhInfo=getMenhBase(year);
  const age=getAge(year);
  const ft=makeFortuneText(zodIdx,year,gender);

  const compatLabel={'great':'ğŸ”¥ Tam há»£p vá»›i nÄƒm Ngá»','bad':'âš ï¸ Xung kháº¯c nÄƒm Ngá»','ok':'â˜¯ï¸ Trung bÃ¬nh vá»›i nÄƒm Ngá»'};
  const compatColor={'great':'var(--green)','bad':'#ff8080','ok':'var(--gold)'};

  const menhIcon={'Kim':'ğŸ¥‡','Má»™c':'ğŸŒ³','Thá»§y':'ğŸ’§','Há»a':'ğŸ”¥','Thá»•':'ğŸŒ'};

  const financeStar=ft.compat==='great'?5:ft.compat==='bad'?2:3;
  const healthStar=(zodIdx%3===0)?4:(zodIdx%3===1)?3:4;
  const loveStar=gender==='nu'?((zodIdx+1)%5)+1:((zodIdx+2)%5)+1;
  const careerStar=ft.compat==='great'?4:ft.compat==='bad'?3:4;

  document.getElementById('tuviResult').innerHTML=`
  <!-- hero -->
  <div class="tuvi-hero">
    <div class="tuvi-zodiac">${zod.name.split(' ')[1]||'ğŸ'}</div>
    <div class="tuvi-name">Tuá»•i ${zod.name}</div>
    <div class="tuvi-sub">${age} tuá»•i &middot; ${menhInfo.stemFull} &middot; Má»‡nh ${menhInfo.menh} ${menhIcon[menhInfo.menh]||''}</div>
    <div class="tuvi-badges">
      <div class="badge">NgÅ© hÃ nh: ${zod.element}</div>
      <div class="badge">${menhInfo.stem} ${menhInfo.branch}</div>
      <div class="badge" style="color:${compatColor[ft.compat]};border-color:${compatColor[ft.compat]}">${compatLabel[ft.compat]}</div>
    </div>
  </div>

  <!-- tá»•ng quan 4 Ã´ -->
  <div class="tuvi-grid" style="margin-bottom:11px">
    <div class="tuvi-box">
      <div class="tuvi-box-ico">ğŸ’°</div>
      <div class="tuvi-box-lbl">TÃ i lá»™c</div>
      <div class="tuvi-box-val">${stars(financeStar)}</div>
    </div>
    <div class="tuvi-box">
      <div class="tuvi-box-ico">â¤ï¸</div>
      <div class="tuvi-box-lbl">TÃ¬nh duyÃªn</div>
      <div class="tuvi-box-val">${stars(Math.min(5,loveStar))}</div>
    </div>
    <div class="tuvi-box">
      <div class="tuvi-box-ico">ğŸ’ª</div>
      <div class="tuvi-box-lbl">Sá»©c khá»e</div>
      <div class="tuvi-box-val">${stars(healthStar)}</div>
    </div>
    <div class="tuvi-box">
      <div class="tuvi-box-ico">ğŸš€</div>
      <div class="tuvi-box-lbl">Sá»± nghiá»‡p</div>
      <div class="tuvi-box-val">${stars(careerStar)}</div>
    </div>
  </div>

  <!-- chi tiáº¿t tá»«ng máº£ng -->
  <div class="card">
    <div class="card-hd">ğŸ’° TÃ i lá»™c nÄƒm 2026</div>
    <div class="fortune-block">${ft.finance}</div>
    <div style="font-size:11px;color:var(--muted)">ThÃ¡ng Ä‘áº¹p: <strong style="color:var(--gold)">${ft.luckyMonth.join(', ')}</strong></div>
  </div>

  <div class="card">
    <div class="card-hd">â¤ï¸ TÃ¬nh duyÃªn</div>
    <div class="fortune-block">${ft.love}</div>
  </div>

  <div class="card">
    <div class="card-hd">ğŸ’ª Sá»©c khá»e</div>
    <div class="fortune-block">${ft.health}</div>
  </div>

  <div class="card">
    <div class="card-hd">ğŸš€ Sá»± nghiá»‡p</div>
    <div class="fortune-block">${ft.career}</div>
  </div>

  <!-- may máº¯n & lÆ°u Ã½ -->
  <div class="card">
    <div class="card-hd">âœ¨ Con sá»‘ & mÃ u may máº¯n</div>
    <div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px">
      <div class="tuvi-box" style="flex:1;min-width:130px">
        <div class="tuvi-box-ico">ğŸ”¢</div>
        <div class="tuvi-box-lbl">Con sá»‘</div>
        <div class="tuvi-box-val">${ft.luckyNum.join(' & ')}</div>
      </div>
      <div class="tuvi-box" style="flex:1;min-width:130px">
        <div class="tuvi-box-ico">ğŸ¨</div>
        <div class="tuvi-box-lbl">MÃ u sáº¯c</div>
        <div class="tuvi-box-val">${ft.luckyColor}</div>
      </div>
    </div>
    <div style="font-size:11px;color:var(--muted);text-align:center">HÆ°á»›ng may máº¯n: <strong style="color:var(--gold)">${ft.luckyDir}</strong></div>
  </div>

  <!-- thÃ¡ng tá»‘t xáº¥u -->
  <div class="card">
    <div class="card-hd">ğŸ“… ThÃ¡ng nÃªn / trÃ¡nh</div>
    <div style="margin-bottom:8px">
      <div style="font-size:11px;color:var(--muted);margin-bottom:6px">ThÃ¡ng thuáº­n lá»£i</div>
      <div>${ft.goodMonths.map(m=>`<span class="aspect-pill pill-good">ThÃ¡ng ${m}</span>`).join('')}</div>
    </div>
    <div>
      <div style="font-size:11px;color:var(--muted);margin-bottom:6px">Cáº§n tháº­n trá»ng</div>
      <div>${ft.badMonths.map(m=>`<span class="aspect-pill pill-bad">ThÃ¡ng ${m}</span>`).join('')}</div>
    </div>
  </div>

  <p style="font-size:11px;color:var(--muted);text-align:center;padding:6px 0 10px">
    âœ¦ Tá»­ vi mang tÃ­nh tham kháº£o, váº­n má»‡nh do chÃ­nh báº¡n táº¡o ra âœ¦
  </p>
  `;
  confetti();
  toast(`ğŸ”® Xem xong tá»­ vi tuá»•i ${zod.name}!`);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   64 Tá»ˆNH THÃ€NH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const PROVINCES=[
  {name:'HÃ  Ná»™i',lat:21.0285,lng:105.8542},
  {name:'TP. Há»“ ChÃ­ Minh',lat:10.8231,lng:106.6297},
  {name:'ÄÃ  Náºµng',lat:16.0544,lng:108.2022},
  {name:'Háº£i PhÃ²ng',lat:20.8449,lng:106.6881},
  {name:'Cáº§n ThÆ¡',lat:10.0452,lng:105.7469},
  {name:'An Giang',lat:10.5215,lng:105.1259},
  {name:'BÃ  Rá»‹a - VÅ©ng TÃ u',lat:10.5417,lng:107.2429},
  {name:'Báº¯c Giang',lat:21.2820,lng:106.1975},
  {name:'Báº¯c Káº¡n',lat:22.1474,lng:105.8348},
  {name:'Báº¡c LiÃªu',lat:9.2940,lng:105.7216},
  {name:'Báº¯c Ninh',lat:21.1861,lng:106.0763},
  {name:'Báº¿n Tre',lat:10.2433,lng:106.3756},
  {name:'BÃ¬nh Äá»‹nh',lat:13.7820,lng:109.2197},
  {name:'BÃ¬nh DÆ°Æ¡ng',lat:11.3254,lng:106.4770},
  {name:'BÃ¬nh PhÆ°á»›c',lat:11.7511,lng:106.7234},
  {name:'BÃ¬nh Thuáº­n',lat:11.0904,lng:108.0721},
  {name:'CÃ  Mau',lat:9.1769,lng:105.1500},
  {name:'Cao Báº±ng',lat:22.6657,lng:106.2638},
  {name:'Äáº¯k Láº¯k',lat:12.7100,lng:108.2378},
  {name:'Äáº¯k NÃ´ng',lat:12.0046,lng:107.6876},
  {name:'Äiá»‡n BiÃªn',lat:21.3860,lng:103.0230},
  {name:'Äá»“ng Nai',lat:11.0686,lng:107.1676},
  {name:'Äá»“ng ThÃ¡p',lat:10.4938,lng:105.6882},
  {name:'Gia Lai',lat:13.9833,lng:108.0000},
  {name:'HÃ  Giang',lat:22.8233,lng:104.9836},
  {name:'HÃ  Nam',lat:20.5453,lng:105.9228},
  {name:'HÃ  TÄ©nh',lat:18.3560,lng:105.8877},
  {name:'Háº£i DÆ°Æ¡ng',lat:20.9373,lng:106.3146},
  {name:'Háº­u Giang',lat:9.7579,lng:105.6413},
  {name:'HÃ²a BÃ¬nh',lat:20.8133,lng:105.3383},
  {name:'HÆ°ng YÃªn',lat:20.6464,lng:106.0511},
  {name:'KhÃ¡nh HÃ²a',lat:12.2388,lng:109.1967},
  {name:'KiÃªn Giang',lat:10.0125,lng:105.0809},
  {name:'Kon Tum',lat:14.3497,lng:108.0000},
  {name:'Lai ChÃ¢u',lat:22.3864,lng:103.4706},
  {name:'LÃ¢m Äá»“ng',lat:11.9465,lng:108.4419},
  {name:'Láº¡ng SÆ¡n',lat:21.8537,lng:106.7615},
  {name:'LÃ o Cai',lat:22.4809,lng:103.9753},
  {name:'Long An',lat:10.6956,lng:106.2429},
  {name:'Nam Äá»‹nh',lat:20.4389,lng:106.1621},
  {name:'Nghá»‡ An',lat:19.2342,lng:104.9200},
  {name:'Ninh BÃ¬nh',lat:20.2506,lng:105.9745},
  {name:'Ninh Thuáº­n',lat:11.5645,lng:108.9889},
  {name:'PhÃº Thá»',lat:21.3227,lng:105.2280},
  {name:'PhÃº YÃªn',lat:13.0882,lng:109.0929},
  {name:'Quáº£ng BÃ¬nh',lat:17.4689,lng:106.5982},
  {name:'Quáº£ng Nam',lat:15.5394,lng:108.0191},
  {name:'Quáº£ng NgÃ£i',lat:15.1214,lng:108.8044},
  {name:'Quáº£ng Ninh',lat:21.0064,lng:107.2925},
  {name:'Quáº£ng Trá»‹',lat:16.8163,lng:107.1018},
  {name:'SÃ³c TrÄƒng',lat:9.6025,lng:105.9740},
  {name:'SÆ¡n La',lat:21.3256,lng:103.9147},
  {name:'TÃ¢y Ninh',lat:11.3351,lng:106.1099},
  {name:'ThÃ¡i BÃ¬nh',lat:20.4500,lng:106.3417},
  {name:'ThÃ¡i NguyÃªn',lat:21.5928,lng:105.8244},
  {name:'Thanh HÃ³a',lat:19.8080,lng:105.7851},
  {name:'Thá»«a ThiÃªn Huáº¿',lat:16.4637,lng:107.5909},
  {name:'Tiá»n Giang',lat:10.3600,lng:106.3600},
  {name:'TrÃ  Vinh',lat:9.9477,lng:106.3424},
  {name:'TuyÃªn Quang',lat:21.8239,lng:105.2182},
  {name:'VÄ©nh Long',lat:10.2397,lng:105.9571},
  {name:'VÄ©nh PhÃºc',lat:21.3609,lng:105.5474},
  {name:'YÃªn BÃ¡i',lat:21.7051,lng:104.9114},
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Ã‚M Lá»ŠCH â€“ Há»“ Ngá»c Äá»©c (báº£n gá»‘c chuáº©n, verified)
   Nguá»“n: informatik.uni-leipzig.de/~duc/amlich/
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const INT = Math.floor;

function jdFromDate(dd, mm, yy) {
  var a = INT((14-mm)/12), y = yy+4800-a, m = mm+12*a-3;
  var jdn = dd + INT((153*m+2)/5) + 365*y + INT(y/4) - INT(y/100) + INT(y/400) - 32045;
  if (jdn < 2299161) jdn = dd + INT((153*m+2)/5) + 365*y + INT(y/4) - 32083;
  return jdn;
}

// Richards 2013 â€“ chÃ­nh xÃ¡c, Ä‘Ã£ kiá»ƒm chá»©ng
function jdToDateG(jd) {
  var f = jd + 1401 + INT((INT((4*jd+274277)/146097)*3)/4) - 38;
  var e = 4*f+3, g = INT((e%1461)/4), h = 5*g+2;
  var M = (INT(h/153)+2)%12+1;
  return { d: INT((h%153)/5)+1, m: M, y: INT(e/1461)-4716+INT((14-M)/12) };
}

function _NewMoon(k) {
  var T=k/1236.85, T2=T*T, T3=T2*T, dr=Math.PI/180;
  var Jde = 2415020.75933 + 29.53058868*k + 0.0001178*T2 - 0.000000155*T3;
  Jde += 0.00033 * Math.sin((166.56 + 132.87*T - 0.009173*T2) * dr);
  var M   = 359.2242  + 29.10535608*k  - 0.0000333*T2  - 0.00000347*T3;
  var Mpr = 306.0253  + 385.81691806*k + 0.0107306*T2  + 0.00001236*T3;
  var F   = 21.2964   + 390.67050646*k - 0.0016528*T2  - 0.00000239*T3;
  var C1  = (0.1734-0.000393*T)*Math.sin(M*dr) + 0.0021*Math.sin(2*dr*M)
          - 0.4068*Math.sin(Mpr*dr)  + 0.0161*Math.sin(2*dr*Mpr) - 0.0004*Math.sin(3*dr*Mpr)
          + 0.0104*Math.sin(2*dr*F)  - 0.0051*Math.sin(dr*(M+Mpr))- 0.0074*Math.sin(dr*(M-Mpr))
          + 0.0004*Math.sin(dr*(2*F+M))  - 0.0004*Math.sin(dr*(2*F-M))
          - 0.0006*Math.sin(dr*(2*F+Mpr))+ 0.0010*Math.sin(dr*(2*F-Mpr))
          + 0.0005*Math.sin(dr*(2*Mpr+M));
  var deltat = (T < -11)
    ? 0.001+0.000839*T+0.0002261*T2-0.00000845*T3-0.000000081*T*T3
    : -0.000278+0.000265*T+0.000262*T2;
  return Jde + C1 - deltat;
}

function _SunLong(jdn) {
  var T=(jdn-2451545.0)/36525, T2=T*T, dr=Math.PI/180;
  var M  = 357.52910+35999.05030*T-0.0001559*T2-0.00000048*T*T2;
  var L0 = 280.46645+36000.76983*T+0.0003032*T2;
  var DL = (1.9146-0.004817*T-0.000014*T2)*Math.sin(dr*M)
         + (0.019993-0.000101*T)*Math.sin(dr*2*M) + 0.00029*Math.sin(dr*3*M);
  var L = (L0+DL)*dr;
  L -= Math.PI*2*INT(L/(Math.PI*2));
  return L;
}
function _getSunLong(jd, tz) { return INT(_SunLong(jd-0.5-tz/24)/Math.PI*6); }
function getNewMoonDay(k, tz) { return INT(_NewMoon(k)+0.5+tz/24); }

function getLunarMonth11(yy, tz) {
  var k  = INT((jdFromDate(31,12,yy)-2415021.076998695)/29.530588853);
  var nm = getNewMoonDay(k, tz);
  var sl = _getSunLong(nm, tz);
  if (sl >= 9) nm = getNewMoonDay(k-1, tz);
  return nm;
}

function _getLeapMonthOffset(a11, tz) {
  var k    = INT((a11-2415021.076998695)/29.530588853+0.5);
  var last = 0, i = 1;
  var arc  = _getSunLong(getNewMoonDay(k+i, tz), tz);
  do { last=arc; i++; arc=_getSunLong(getNewMoonDay(k+i,tz),tz); }
  while (arc !== last && i < 14);
  return i - 1;
}

function solarToLunar(dd, mm, yy) {
  var tz = 7;
  var dayNumber  = jdFromDate(dd, mm, yy);
  var k          = INT((dayNumber-2415021.076998695)/29.530588853);
  var monthStart = getNewMoonDay(k+1, tz);
  if (monthStart > dayNumber) monthStart = getNewMoonDay(k, tz);

  var a11 = getLunarMonth11(yy, tz);
  var b11 = a11, lunarYear;
  if (a11 >= monthStart) {
    lunarYear = yy;
    a11 = getLunarMonth11(yy-1, tz);
  } else {
    lunarYear = yy+1;
    b11 = getLunarMonth11(yy+1, tz);
  }

  var lunarDay   = dayNumber - monthStart + 1;
  var diff       = INT((monthStart-a11)/29);
  var lunarLeap  = 0;
  var lunarMonth = diff + 11;

  if (b11-a11 > 365) {
    var lmo = _getLeapMonthOffset(a11, tz);
    if (diff >= lmo) {
      lunarMonth = diff + 10;
      if (diff === lmo) lunarLeap = 1;
    }
  }
  if (lunarMonth > 12) lunarMonth -= 12;
  if (lunarMonth >= 11 && diff < 4) lunarYear--;

  return { day:lunarDay, month:lunarMonth, year:lunarYear, leap:lunarLeap };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GIá»œ HOÃ€NG Äáº O
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
// Based on lunar day
function getHoangDao(lunarDay){
  // 12 branches cycle for hoang dao / hac dao
  // Day 1,7,13,19,25 -> start with TÃ½
  const BRANCHES=['TÃ½','Sá»­u','Dáº§n','MÃ£o','ThÃ¬n','Tá»µ','Ngá»','MÃ¹i','ThÃ¢n','Dáº­u','Tuáº¥t','Há»£i'];
  const HOURS=[
    {branch:'TÃ½',range:'23-01',time:'23:00â€“01:00'},
    {branch:'Sá»­u',range:'01-03',time:'01:00â€“03:00'},
    {branch:'Dáº§n',range:'03-05',time:'03:00â€“05:00'},
    {branch:'MÃ£o',range:'05-07',time:'05:00â€“07:00'},
    {branch:'ThÃ¬n',range:'07-09',time:'07:00â€“09:00'},
    {branch:'Tá»µ',range:'09-11',time:'09:00â€“11:00'},
    {branch:'Ngá»',range:'11-13',time:'11:00â€“13:00'},
    {branch:'MÃ¹i',range:'13-15',time:'13:00â€“15:00'},
    {branch:'ThÃ¢n',range:'15-17',time:'15:00â€“17:00'},
    {branch:'Dáº­u',range:'17-19',time:'17:00â€“19:00'},
    {branch:'Tuáº¥t',range:'19-21',time:'19:00â€“21:00'},
    {branch:'Há»£i',range:'21-23',time:'21:00â€“23:00'},
  ];
  // Hoang dao pattern by day mod 6 (simplified traditional)
  const patterns=[
    [1,1,0,1,0,0,1,0,1,0,0,1], // day%6==1
    [0,1,0,0,1,0,1,1,0,1,0,0], // day%6==2
    [0,0,1,0,1,1,0,1,0,0,1,0], // day%6==3
    [1,0,1,0,0,1,0,1,1,0,1,0], // day%6==4
    [0,1,0,1,0,0,1,0,1,1,0,1], // day%6==5
    [1,0,0,1,0,1,0,0,1,0,1,1], // day%6==0
  ];
  const pat=patterns[lunarDay%6];
  return HOURS.map((h,i)=>({...h,good:pat[i]===1}));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Máº¶T TRá»œI Má»ŒC / Láº¶N (simplified)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getSunTimes(lat, lng){
  const now=new Date();
  const J0=0.0009;
  const phi=lat*Math.PI/180;
  const n=Math.ceil(now.getTime()/86400000 - (2451545-2440588) - J0 - lng/360);
  const Jstar=n+J0-lng/360;
  const M=(357.5291+0.98560028*Jstar)*Math.PI/180;
  const C=1.9148*Math.sin(M)+0.02*Math.sin(2*M)+0.0003*Math.sin(3*M);
  const lam=(280.46+Jstar*0.98564736+C+180)*Math.PI/180;
  const sindec=Math.sin(lam)*Math.sin(23.44*Math.PI/180);
  const cosHA=-Math.tan(phi)*Math.tan(Math.asin(sindec));
  if(cosHA<-1||cosHA>1) return null;
  const HA=Math.acos(cosHA)/(2*Math.PI);
  const Jtr=2451545+Jstar+0.0053*Math.sin(M)-0.0069*Math.sin(2*lam);
  const Jset=Jtr+HA;
  const Jrise=Jtr-HA;
  function jdToHHMM(jd){
    const ms=((jd-Math.floor(jd))*86400+7*3600)%86400;
    const h=Math.floor(ms/3600),m=Math.floor((ms%3600)/60);
    return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
  }
  return {rise:jdToHHMM(Jrise),set:jdToHHMM(Jset)};
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WEATHER API (Open-Meteo â€“ miá»…n phÃ­)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const WMO_CODES={
  0:'Trá»i quang',1:'Ãt mÃ¢y',2:'MÃ¢y ráº£i rÃ¡c',3:'Nhiá»u mÃ¢y',
  45:'SÆ°Æ¡ng mÃ¹',48:'SÆ°Æ¡ng Ä‘á»ng',
  51:'MÆ°a phÃ¹n nháº¹',53:'MÆ°a phÃ¹n vá»«a',55:'MÆ°a phÃ¹n dÃ y',
  61:'MÆ°a nháº¹',63:'MÆ°a vá»«a',65:'MÆ°a to',
  71:'Tuyáº¿t nháº¹',73:'Tuyáº¿t vá»«a',75:'Tuyáº¿t dÃ y',
  80:'MÆ°a rÃ o nháº¹',81:'MÆ°a rÃ o vá»«a',82:'MÆ°a rÃ o náº·ng',
  95:'DÃ´ng',96:'DÃ´ng cÃ³ mÆ°a Ä‘Ã¡',99:'DÃ´ng mÆ°a Ä‘Ã¡ lá»›n',
};
const WMO_ICONS={
  0:'â˜€ï¸',1:'ğŸŒ¤ï¸',2:'â›…',3:'â˜ï¸',
  45:'ğŸŒ«ï¸',48:'ğŸŒ«ï¸',
  51:'ğŸŒ¦ï¸',53:'ğŸŒ¦ï¸',55:'ğŸŒ¦ï¸',
  61:'ğŸŒ§ï¸',63:'ğŸŒ§ï¸',65:'â›ˆï¸',
  71:'â„ï¸',73:'â„ï¸',75:'â„ï¸',
  80:'ğŸŒ¦ï¸',81:'ğŸŒ§ï¸',82:'â›ˆï¸',
  95:'â›ˆï¸',96:'â›ˆï¸',99:'â›ˆï¸',
};

const DOW_VI=['CN','T2','T3','T4','T5','T6','T7'];
const MONTH_VI_CAN=['Canh','TÃ¢n','NhÃ¢m','QuÃ½','GiÃ¡p','áº¤t','BÃ­nh','Äinh','Máº­u','Ká»·','Canh','TÃ¢n'];
const MONTH_VI_CHI=['Dáº§n','MÃ£o','ThÃ¬n','Tá»µ','Ngá»','MÃ¹i','ThÃ¢n','Dáº­u','Tuáº¥t','Há»£i','TÃ½','Sá»­u'];
const DAY_CAN=['GiÃ¡p','áº¤t','BÃ­nh','Äinh','Máº­u','Ká»·','Canh','TÃ¢n','NhÃ¢m','QuÃ½'];
const DAY_CHI=['TÃ½','Sá»­u','Dáº§n','MÃ£o','ThÃ¬n','Tá»µ','Ngá»','MÃ¹i','ThÃ¢n','Dáº­u','Tuáº¥t','Há»£i'];

function getDayCanChi(date){
  // Anchor Ä‘Ã£ kiá»ƒm chá»©ng: 2000-02-04 dÆ°Æ¡ng lá»‹ch = ngÃ y GiÃ¡p TÃ½
  const jd  = jdFromDate(date.getDate(), date.getMonth()+1, date.getFullYear());
  const anc = jdFromDate(4, 2, 2000); // GiÃ¡p TÃ½
  const diff = jd - anc;
  return DAY_CAN[((diff%10)+10)%10] + ' ' + DAY_CHI[((diff%12)+12)%12];
}

async function loadWeather(){
  const sel=document.getElementById('provSelect');
  const idx=sel.value;
  if(idx===''){document.getElementById('weatherResult').innerHTML='';return;}
  const prov=PROVINCES[idx];
  if(!prov)return;
  document.getElementById('weatherResult').innerHTML=`<div class="spinner"><div class="spin-ring"></div></div>`;

  try {
    const url=`https://api.open-meteo.com/v1/forecast?latitude=${prov.lat}&longitude=${prov.lng}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m,pressure_msl&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum,wind_speed_10m_max&hourly=temperature_2m,relative_humidity_2m&timezone=Asia%2FHo_Chi_Minh&forecast_days=5`;
    const res=await fetch(url);
    const json=await res.json();
    renderWeather(prov, json);
  } catch(e){
    document.getElementById('weatherResult').innerHTML=`<div class="card"><p style="color:#ff8080;text-align:center">KhÃ´ng táº£i Ä‘Æ°á»£c thá»i tiáº¿t. Kiá»ƒm tra káº¿t ná»‘i máº¡ng.</p></div>`;
  }
}

function renderWeather(prov, json){
  const cur=json.current;
  const daily=json.daily;
  const temp=Math.round(cur.temperature_2m);
  const feels=Math.round(cur.apparent_temperature);
  const hum=cur.relative_humidity_2m;
  const wind=Math.round(cur.wind_speed_10m);
  const wcode=cur.weather_code;
  const desc=WMO_CODES[wcode]||'KhÃ´ng xÃ¡c Ä‘á»‹nh';
  const icon=WMO_ICONS[wcode]||'ğŸŒ¡ï¸';

  // Lunar
  const now=new Date();
  const lunar=solarToLunar(now.getDate(),now.getMonth()+1,now.getFullYear());
  const dowVI=DOW_VI[now.getDay()];
  const dayCC=getDayCanChi(now);
  const monthIdx=now.getMonth();
  const monthCC=`${MONTH_VI_CAN[monthIdx]} ${MONTH_VI_CHI[monthIdx]}`;

  // Sun times
  const sun=getSunTimes(prov.lat,prov.lng)||{rise:'06:00',set:'18:00'};

  // Hoang dao
  const hoangDao=getHoangDao(lunar.day);
  const goodHours=hoangDao.filter(h=>h.good);
  const badHours=hoangDao.filter(h=>!h.good);

  // Suggestions
  const suggests=makeSuggestions(temp,hum,wind,wcode);

  // 5-day forecast
  const forecastHTML=daily.time.slice(0,5).map((dateStr,i)=>{
    const d=new Date(dateStr);
    const dow=DOW_VI[d.getDay()];
    const tmax=Math.round(daily.temperature_2m_max[i]);
    const tmin=Math.round(daily.temperature_2m_min[i]);
    const rain=daily.precipitation_sum[i];
    const wc=daily.weather_code[i];
    return `
    <div style="display:flex;align-items:center;gap:8px;padding:8px 0;border-bottom:1px solid var(--border)">
      <div style="font-size:10px;color:var(--muted);width:26px;flex-shrink:0">${dow}<br><span style="color:var(--text);font-weight:700">${d.getDate()}</span></div>
      <div style="font-size:22px;flex-shrink:0">${WMO_ICONS[wc]||'ğŸŒ¡ï¸'}</div>
      <div style="flex:1;font-size:11px;color:var(--muted)">${WMO_CODES[wc]||''}${rain>0?` Â· ğŸ’§${rain.toFixed(1)}mm`:''}</div>
      <div style="text-align:right;flex-shrink:0">
        <span style="font-size:14px;font-weight:800;color:var(--gold)">${tmax}Â°</span>
        <span style="font-size:11px;color:var(--muted);margin-left:4px">${tmin}Â°</span>
      </div>
    </div>`;
  }).join('');

  document.getElementById('weatherResult').innerHTML=`
  <!-- hero thá»i tiáº¿t -->
  <div class="weather-hero">
    <div class="weather-icon">${icon}</div>
    <div class="weather-temp">${temp}Â°C</div>
    <div class="weather-desc">${desc}</div>
    <div class="weather-loc">ğŸ“ ${prov.name}</div>
    <div style="font-size:11px;color:rgba(180,210,255,.5);margin-top:4px">Cáº£m giÃ¡c nhÆ° ${feels}Â°C</div>
  </div>

  <!-- thÃ´ng sá»‘ nhanh -->
  <div class="weather-grid">
    <div class="w-box">
      <div class="w-box-ico">ğŸ’§</div>
      <div class="w-box-lbl">Äá»™ áº©m</div>
      <div class="w-box-val">${hum}%</div>
    </div>
    <div class="w-box">
      <div class="w-box-ico">ğŸ’¨</div>
      <div class="w-box-lbl">GiÃ³</div>
      <div class="w-box-val">${wind} km/h</div>
    </div>
    <div class="w-box">
      <div class="w-box-ico">ğŸŒ¡ï¸</div>
      <div class="w-box-lbl">Ãp suáº¥t</div>
      <div class="w-box-val">${Math.round(cur.pressure_msl)} hPa</div>
    </div>
  </div>

  <!-- máº·t trá»i -->
  <div class="card">
    <div class="card-hd">ğŸŒ… Máº·t trá»i</div>
    <div class="sun-row">
      <div class="sun-item"><div class="sun-ico">ğŸŒ…</div><div class="sun-time">${sun.rise}</div><div class="sun-lbl">Má»c</div></div>
      <div class="sun-item"><div class="sun-ico">ğŸŒ‡</div><div class="sun-time">${sun.set}</div><div class="sun-lbl">Láº·n</div></div>
    </div>
  </div>

  <!-- Ã¢m lá»‹ch -->
  <div class="lunar-card">
    <div class="card-hd">ğŸŒ™ Lá»‹ch Ã¢m hÃ´m nay</div>
    <div class="lunar-date">NgÃ y ${lunar.day} thÃ¡ng ${lunar.month}${lunar.leap?' (nhuáº­n)':''} nÄƒm ${lunar.year}</div>
    <div class="lunar-day">${dowVI} Â· NgÃ y ${dayCC} Â· ThÃ¡ng ${monthCC}</div>
    <div class="lunar-row">
      <span class="lunar-tag tag-gold">${dowVI} ${now.getDate()}/${now.getMonth()+1}/${now.getFullYear()}</span>
      <span class="lunar-tag tag-gold">NgÃ y ${dayCC}</span>
    </div>
  </div>

  <!-- giá» hoÃ ng Ä‘áº¡o -->
  <div class="card">
    <div class="card-hd">â° Giá» hoÃ ng Ä‘áº¡o hÃ´m nay</div>
    <p style="font-size:11px;color:var(--muted);margin-bottom:10px">Giá» xanh = HoÃ ng Ä‘áº¡o Â· Giá» Ä‘á» = Háº¯c Ä‘áº¡o</p>
    <div class="hours-grid">
      ${hoangDao.map(h=>`
      <div class="hour-box ${h.good?'hour-good':'hour-bad'}">
        <div class="hour-lbl">Giá» ${h.branch}</div>
        <div class="hour-sub">${h.time}</div>
      </div>`).join('')}
    </div>
    <div style="margin-top:12px;font-size:11px;color:var(--muted)">
      Giá» tá»‘t hÃ´m nay: <strong style="color:#2ECC71">${goodHours.map(h=>h.branch).join(', ')}</strong>
    </div>
  </div>

  <!-- dá»± bÃ¡o 5 ngÃ y -->
  <div class="card">
    <div class="card-hd">ğŸ“… Dá»± bÃ¡o 5 ngÃ y tá»›i</div>
    ${forecastHTML}
  </div>

  <!-- Ä‘á» xuáº¥t -->
  <div class="card">
    <div class="card-hd">ğŸ’¡ Gá»£i Ã½ hÃ´m nay</div>
    ${suggests.map(s=>`<div class="suggest-item"><div class="suggest-ico">${s.ico}</div><div>${s.txt}</div></div>`).join('')}
  </div>
  `;
}

function makeSuggestions(temp,hum,wind,wcode){
  const s=[];
  if(temp>=35) s.push({ico:'ğŸŒ¡ï¸',txt:'Nhiá»‡t Ä‘á»™ ráº¥t cao! Háº¡n cháº¿ ra ngoÃ i tá»« 11-15h, uá»‘ng Ä‘á»§ 2-3 lÃ­t nÆ°á»›c má»—i ngÃ y.'});
  else if(temp>=30) s.push({ico:'â˜€ï¸',txt:'Trá»i nÃ³ng, nÃªn máº·c Ä‘á»“ thoÃ¡ng mÃ¡t vÃ  bÃ´i kem chá»‘ng náº¯ng khi ra ngoÃ i.'});
  else if(temp<=20) s.push({ico:'ğŸ§¥',txt:'Trá»i mÃ¡t, nÃªn mang theo Ã¡o khoÃ¡c nháº¹ khi Ä‘i chÆ¡i Táº¿t.'});
  else if(temp<=15) s.push({ico:'ğŸ§£',txt:'Trá»i láº¡nh! Máº·c Ä‘á»§ áº¥m, Ä‘áº·c biá»‡t khi Ä‘i chÆ¡i ngoÃ i trá»i.'});
  else s.push({ico:'ğŸ˜Š',txt:'Thá»i tiáº¿t dá»… chá»‹u, thÃ­ch há»£p cho cÃ¡c hoáº¡t Ä‘á»™ng ngoÃ i trá»i.'});

  if(hum>85) s.push({ico:'ğŸ’§',txt:'Äá»™ áº©m cao, cáº£m giÃ¡c nÃ³ng hÆ¡n thá»±c táº¿. DÃ¹ng Ä‘iá»u hÃ²a hoáº·c quáº¡t Ä‘á»ƒ thoáº£i mÃ¡i hÆ¡n.'});
  else if(hum<40) s.push({ico:'ğŸœï¸',txt:'KhÃ´ng khÃ­ khÃ´, nÃªn dÃ¹ng mÃ¡y táº¡o áº©m vÃ  uá»‘ng nhiá»u nÆ°á»›c.'});

  if(wind>40) s.push({ico:'ğŸ’¨',txt:'GiÃ³ máº¡nh, cáº©n tháº­n khi lÃ¡i xe mÃ¡y vÃ  trÃ¡nh Ä‘á»©ng gáº§n cÃ¢y cao.'});
  else if(wind>20) s.push({ico:'ğŸŒ¬ï¸',txt:'CÃ³ giÃ³, mang theo Ã¡o khoÃ¡c náº¿u Ä‘i chÆ¡i buá»•i tá»‘i.'});

  if([61,63,65,80,81,82,95,96,99].includes(wcode)) s.push({ico:'â˜‚ï¸',txt:'CÃ³ mÆ°a! Nhá»› mang Ã´ hoáº·c Ã¡o mÆ°a khi ra Ä‘Æ°á»ng. ÄÆ°á»ng cÃ³ thá»ƒ trÆ¡n, lÃ¡i xe cáº©n tháº­n.'});
  if([95,96,99].includes(wcode)) s.push({ico:'âš¡',txt:'CÃ³ dÃ´ng! TrÃ¡nh ra ngoÃ i, khÃ´ng Ä‘á»©ng dÆ°á»›i cÃ¢y hay nÆ¡i trá»‘ng tráº£i.'});

  // General Tet tips
  s.push({ico:'ğŸ§§',txt:'NÄƒm má»›i BÃ­nh Ngá» 2026 â€“ chÃºc báº¡n vÃ  gia Ä‘Ã¬nh váº¡n sá»± nhÆ° Ã½!'});
  return s;
}

async function locateMe(){
  if(!navigator.geolocation){toast('TrÃ¬nh duyá»‡t khÃ´ng há»— trá»£ GPS');return;}
  toast('ğŸ“ Äang xÃ¡c Ä‘á»‹nh vá»‹ trÃ­...');
  navigator.geolocation.getCurrentPosition(pos=>{
    const {latitude:lat,longitude:lng}=pos.coords;
    // Find nearest province
    let minDist=Infinity,minIdx=0;
    PROVINCES.forEach((p,i)=>{
      const d=Math.sqrt((p.lat-lat)**2+(p.lng-lng)**2);
      if(d<minDist){minDist=d;minIdx=i;}
    });
    document.getElementById('provSelect').value=minIdx;
    loadWeather();
  },()=>toast('KhÃ´ng láº¥y Ä‘Æ°á»£c vá»‹ trÃ­'));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFETTI & TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const CF_COLORS=['#FFD700','#FF6B6B','#FF9F43','#fff','#FF3838','#FECA57','#48DBFB'];
function confetti(){
  for(let i=0;i<28;i++){
    const el=document.createElement('div');
    el.className='cf';
    el.style.cssText=`left:${Math.random()*100}vw;top:${Math.random()*40+10}vh;width:${Math.random()*7+4}px;height:${Math.random()*7+4}px;background:${CF_COLORS[Math.floor(Math.random()*CF_COLORS.length)]};border-radius:${Math.random()>.5?'50%':'2px'};animation-delay:${Math.random()*.5}s;animation-duration:${Math.random()*1.2+1.4}s;`;
    document.body.appendChild(el);
    setTimeout(()=>el.remove(),2500);
  }
}
let toastTimer;
function toast(msg){
  const el=document.getElementById('toast');
  el.textContent=msg; el.classList.add('on');
  clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>el.classList.remove('on'),2400);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
// Populate province select
const sel=document.getElementById('provSelect');
PROVINCES.forEach((p,i)=>{
  const opt=document.createElement('option');
  opt.value=i; opt.textContent=p.name;
  sel.appendChild(opt);
});

renderHome();
drawWheel(0);
</script>
</body>
</html>